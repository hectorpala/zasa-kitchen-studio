// Optimized Lazy Loading with WebP Support - ZASA Kitchen Studio v2.0
(function(){"use strict";function supportsWebP(){return new Promise(resolve=>{const webP=new Image();webP.onload=webP.onerror=()=>resolve(webP.height===2);webP.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA"})}let webpSupport=false;supportsWebP().then(supported=>webpSupport=supported);function createPictureElement(img){const picture=document.createElement("picture");const webpSource=document.createElement("source");const jpgSource=document.createElement("source");const fallbackImg=img.cloneNode(true);const srcPath=img.dataset.src||img.src;const webpPath=srcPath.replace(/\.(jpg|jpeg|png)$/i,".webp");if(webpSupport){webpSource.srcset=webpPath;webpSource.type="image/webp"}jpgSource.srcset=srcPath;jpgSource.type="image/jpeg";if(img.dataset.srcset){const webpSrcset=img.dataset.srcset.replace(/\.(jpg|jpeg|png)/gi,".webp");webpSource.srcset=webpSrcset;jpgSource.srcset=img.dataset.srcset}fallbackImg.src=srcPath;fallbackImg.removeAttribute("data-src");fallbackImg.removeAttribute("data-srcset");fallbackImg.classList.add("lazyloaded");picture.appendChild(webpSource);picture.appendChild(jpgSource);picture.appendChild(fallbackImg);return picture}function loadImage(img){if(img.classList.contains("lazyloaded"))return;const srcPath=img.dataset.src||img.src;if(srcPath.match(/\.(jpg|jpeg|png)$/i)&&webpSupport){const picture=createPictureElement(img);img.parentNode.replaceChild(picture,img);return}img.src=img.dataset.src||img.src;if(img.dataset.srcset){img.srcset=img.dataset.srcset;img.removeAttribute("data-srcset")}img.removeAttribute("data-src");img.classList.add("lazyloaded");img.addEventListener("load",()=>img.style.opacity="1")}if("IntersectionObserver"in window){const imageObserver=new IntersectionObserver((entries,observer)=>{entries.forEach(entry=>{if(entry.isIntersecting){loadImage(entry.target);observer.unobserve(entry.target)}})},{rootMargin:"50px 0px",threshold:0.01});document.querySelectorAll("img[data-src],img[loading='lazy']").forEach(img=>{img.style.opacity="0";img.style.transition="opacity 0.3s ease";imageObserver.observe(img)})}else{document.querySelectorAll("img[data-src],img[loading='lazy']").forEach(loadImage)}document.addEventListener("DOMContentLoaded",()=>{document.body.classList.add("fonts-loaded")});const style=document.createElement("style");style.textContent=`img[data-src]{opacity:0;transition:opacity 0.3s ease}.lazyloaded{opacity:1 !important}picture{display:inline-block}picture img{display:block;width:100%;height:auto}`;document.head.appendChild(style)})();