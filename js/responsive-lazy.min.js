// Enhanced Responsive + Lazy Loading - ZASA Kitchen Studio v3.0
(function(){"use strict";const BREAKPOINTS={mobile:480,tablet:768,desktop:1200};function getDeviceType(){const w=window.innerWidth;return w<=BREAKPOINTS.mobile?"mobile":w<=BREAKPOINTS.tablet?"tablet":"desktop"}function updatePictureSourcesOnResize(){const pictures=document.querySelectorAll("picture");pictures.forEach(picture=>{const img=picture.querySelector("img");const sources=picture.querySelectorAll("source");if(img&&!img.classList.contains("lazyloaded"))return;const deviceType=getDeviceType();sources.forEach(source=>{const media=source.getAttribute("media");const srcset=source.getAttribute("srcset");if(media&&srcset){const shouldLoad=media.includes("max-width: 480px")&&deviceType==="mobile"||media.includes("max-width: 768px")&&deviceType==="tablet"||!media.includes("max-width")&&deviceType==="desktop";if(shouldLoad&&!source.hasAttribute("data-loaded")){source.setAttribute("data-loaded","true")}}})})}function initResponsiveLazyLoading(){const observer=new IntersectionObserver((entries,obs)=>{entries.forEach(entry=>{if(entry.isIntersecting){const picture=entry.target;const img=picture.querySelector("img");const sources=picture.querySelectorAll("source[data-srcset]");sources.forEach(source=>{if(source.dataset.srcset){source.srcset=source.dataset.srcset;source.removeAttribute("data-srcset")}});if(img&&img.dataset.src){img.src=img.dataset.src;img.removeAttribute("data-src")}if(img&&img.dataset.srcset){img.srcset=img.dataset.srcset;img.removeAttribute("data-srcset")}img.classList.add("lazyloaded");img.style.opacity="1";obs.unobserve(picture)}})},{rootMargin:"50px 0px",threshold:0.01});document.querySelectorAll("picture").forEach(picture=>{const img=picture.querySelector("img");if(img){img.style.opacity="0";img.style.transition="opacity 0.3s ease";observer.observe(picture)}})}function preloadCriticalImages(){const hero=document.querySelector(".hero");const criticalPictures=document.querySelectorAll(".service-card:nth-child(-n+3) picture");[hero,...criticalPictures].forEach(element=>{if(element){const img=element.querySelector?element.querySelector("img"):null;if(img&&img.dataset.src){const deviceType=getDeviceType();let srcToPreload=img.dataset.src;if(element.querySelector&&element.querySelector("source")){const appropriateSource=element.querySelector(`source[media*="${BREAKPOINTS[deviceType]}"]`);if(appropriateSource&&appropriateSource.dataset.srcset){srcToPreload=appropriateSource.dataset.srcset.split(" ")[0]}}const link=document.createElement("link");link.rel="preload";link.as="image";link.href=srcToPreload;link.fetchPriority="high";document.head.appendChild(link)}}})}let resizeTimeout;window.addEventListener("resize",()=>{clearTimeout(resizeTimeout);resizeTimeout=setTimeout(updatePictureSourcesOnResize,150)});if("IntersectionObserver"in window){document.addEventListener("DOMContentLoaded",()=>{preloadCriticalImages();initResponsiveLazyLoading();updatePictureSourcesOnResize()})}else{document.querySelectorAll("picture img[data-src]").forEach(img=>{img.src=img.dataset.src;img.removeAttribute("data-src");img.style.opacity="1"})}const perfObserver=new PerformanceObserver(list=>{list.getEntries().forEach(entry=>{if(entry.entryType==="largest-contentful-paint"){console.log(`LCP: ${entry.startTime}ms`)}})});if("PerformanceObserver"in window){perfObserver.observe({entryTypes:["largest-contentful-paint"]})}})();